# 20_ans 消融实验报告
# 复赛数据集
PS C:\Users\chen\Desktop\trajectory> D:/Anaconda/Scripts/activate
PS C:\Users\chen\Desktop\trajectory> conda activate base
PS C:\Users\chen\Desktop\trajectory> & D:/Anaconda/python.exe c:/Users/chen/Desktop/trajectory/common/分析复赛分布.py
================================================================================
复赛数据深度分析
================================================================================

【基本信息】
  总记录数: 32,426
  时间范围: 2025-06-25 05:00:00 ~ 2025-06-26 05:00:00
  时间跨度: 24.0 小时

【数据类型分布】
  ESM记录: 14,127 (43.6%)
  雷达记录: 18,299 (56.4%)

【传感器分布】
  ESM传感器 (1, 5, 10):
    传感器 1:  3159 条 (22.4%), 覆盖 330 艘 船
    传感器 5:  6924 条 (49.0%), 覆盖 500 艘 船
    传感器10:  4044 条 (28.6%), 覆盖 405 艘 船

  2D雷达传感器 (2,3,4,6,7,8,9):
    传感器 2:  1650 条 (9.0%)
    传感器 3:  1685 条 (9.2%)
    传感器 4:  4053 条 (22.1%)
    传感器 6:  4534 条 (24.8%)
    传感器 7:  1764 条 (9.6%)
    传感器 8:  2525 条 (13.8%)
    传感器 9:  2088 条 (11.4%)

【船舶统计】
  船舶数量: 500

  每艘船的ESM观测点数:
    平均: 28.3
    中位数: 25
    最大: 92
    最小: 8

  每艘船的观测时长:
    平均: 355.5 分钟 (5.9 小时)
    中位数: 315 分钟 (5.2 小时)
    最大: 940 分钟 (15.7 小时)
    最小: 70 分钟 (1.2 小时)

  观测频率分析:
    平均观测间隔: 13.0 分钟
    中位数观测间隔: 10 分钟
    最大观测间隔: 120 分钟
    最小观测间隔: 0 分钟

【ESM交叉点分析】
  有交叉点的船舶: 500 / 500

  双ESM交叉点数量:
    平均: 8.63
    中位数: 8
    最大: 23
    最小: 2

  三ESM交叉点数量:
    平均: 0.83
    中位数: 0
    最大: 10
    有三ESM交叉点的船舶: 170 / 500

  质量分层:
    low      (交叉点 <2):   0 艘 (  0.0%)
    medium   (交叉点 2-4):  43 艘 (  8.6%)
    high     (交叉点 >=5): 457 艘 ( 91.4%)

【5号ESM覆盖分析】（关键！）
  5号ESM观测的船舶: 500 / 500 (100.0%)
  5号ESM总观测点: 6,924

  5号ESM每艘船的观测点数:
    平均: 13.8
    中位数: 12
    最大: 38
    最小: 3

  5号ESM与其他ESM同时观测分析:
    5号ESM与其他ESM同时观测次数: 4,259
    占5号ESM总观测的比例: 61.5%
    其中与1号ESM同时: 2,057 (48.3%)
    其中与10号ESM同时: 2,619 (61.5%)
PS C:\Users\chen\Desktop\trajectory> 



**实验**: 29个 | **基线**: 22.83 | **最优**: 29.16 (+27.7%) | **日期**: 2025-11-11

---

## 核心发现

**ESM角度阈值 0.001° → 0.065° 提升 27.7%**

---

## 参数影响力

| 参数 | 影响 | 最优值 | 提升 |
|------|:----:|--------|:----:|
| **ESM角度阈值** | ⭐⭐⭐⭐⭐ | 0.060-0.070° | +27.7% |
| **RANSAC模块** | ⭐⭐⭐⭐⭐ | 开启 | -16.0% (关闭) |
| **ESM距离检查** | ⭐⭐⭐⭐⭐ | 200km | -35.7% (150km) |
| 插值迭代次数 | ⭐⭐⭐ | 5轮 | +1.2% |
| ESM合并模块 | ⭐⭐⭐ | 开启 | -2.5% (关闭) |
| 去重模块 | ⭐ | 关闭 | +0.3% |
| 去重距离 | - | 任意 | 0% |
| ESM速度阈值 | - | 任意 | 0% |

---

## ESM角度阈值数据

| 角度 | 得分 | 提升 | 趋势 |
|:----:|:----:|:----:|:----:|
| **0.060°** | **29.16** | **+27.7%** | ⭐ 最优 |
| **0.070°** | **29.16** | **+27.7%** | ⭐ 最优 |
| 0.050° | 29.15 | +27.7% | ✅ |
| 0.045° | 29.12 | +27.5% | ✅ |
| 0.040° | 29.09 | +27.4% | ✅ |
| 0.080° | 29.00 | +27.0% | ⚠️ 下降 |
| 0.030° | 28.79 | +26.1% | ✅ |
| 0.020° | 27.93 | +22.3% | ✅ |
| 0.010° | 27.01 | +18.3% | ✅ |
| **0.001°** | **22.83** | **0%** | 基线 |
| 0.0005° | 22.49 | -1.5% | ❌ |

**趋势**: 0.001°→0.030° 快速上升 → 0.030°→0.070° 平台期(最优) → 0.070°+ 缓慢下降

---

## 最优配置

```python
optimal_config = {
    'esm_angle_threshold': 0.065,      # ⭐⭐⭐ 关键参数
    'enable_deduplication': False,     # ⭐ 关闭去重
    'iteration_rounds': 5,             # ⭐ 5轮迭代
    'enable_ransac': True,             # ⭐⭐⭐ 必须开启
    'enable_esm_merge': True,          # ⭐ 必须开启
    'esm_check_distance': 200000,      # 保持200km
    'safe_distance': 200,
    'esm_speed_threshold': 1000,
    'update_distance': 600,
    'update_speed': 800,
    'update_angle': 90,
    'ransac_distance': 500,
    'ransac_min_points': 5,
}
```

**预期得分**: ~29.5 (提升 ~29%)

---

## 关键结论

1. **ESM角度阈值 0.065°** - 最关键优化 (+27.7%)
2. **RANSAC必须开启** - 关闭损失16%
3. **ESM距离检查≥200km** - 150km损失35.7%
4. **关闭去重** - 小幅提升0.3%
5. **5轮迭代** - 提升1.2%

---

## 快速应用

修改 `our_ans/20_ans/preprocess.py`:
```python
# Line 228: 修改角度阈值
if abs(angle_diff) < 0.065:  # 原: 0.001

# Line 108: 注释掉去重
# deduplacate_radar_points_updated = dedumplacate(...)
```

修改 `our_ans/20_ans/simple_interpolation.py`:
```python
# Line 230: 修改迭代次数
nrand = 5  # 原: 3
```

或运行: `python our_ans/run_optimal.py`
