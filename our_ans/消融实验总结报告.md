# 20_ans 方法消融实验总结报告

**实验日期**: 2025-11-11
**实验阶段**: 两阶段完整消融实验
**总实验数量**: 29个 (第一阶段19个 + 第二阶段10个)
**基线得分**: 22.83
**最优得分**: 29.16 (提升 **+27.7%** 🎉)

---

## 🎯 核心发现

> **ESM角度阈值是最关键参数！**
> 从 0.001° 放宽到 **0.060°-0.070°** 可将得分从 22.83 提升至 **29.16**，提升幅度达 **27.7%**！

---

## 📊 一、ESM角度阈值完整探索结果

### 第一阶段 + 第二阶段完整数据

| 排名 | 角度阈值 | 得分 | 相对基线 | 提升幅度 | 趋势 |
|:---:|:-------:|:----:|:-------:|:-------:|:----:|
| 🥇 | **0.0600°** | **29.16** | **+6.33** | **+27.7%** | ⭐ 最优 |
| 🥇 | **0.0700°** | **29.16** | **+6.33** | **+27.7%** | ⭐ 最优 |
| 🥈 | 0.0500° | 29.15 | +6.32 | +27.7% | ✅ 接近最优 |
| � | 0.0450° | 29.12 | +6.29 | +27.5% | ✅ 接近最优 |
| 4 | 0.0400° | 29.09 | +6.26 | +27.4% | ✅ 优秀 |
| 5 | 0.0800° | 29.00 | +6.17 | +27.0% | ⚠️ 开始下降 |
| 5 | 0.0900° | 29.00 | +6.17 | +27.0% | ⚠️ 开始下降 |
| 7 | 0.0350° | 28.83 | +6.00 | +26.3% | ✅ 优秀 |
| 8 | 0.0300° | 28.79 | +5.96 | +26.1% | ✅ 优秀 |
| 9 | 0.1000° | 28.70 | +5.87 | +25.7% | ⚠️ 继续下降 |
| 10 | 0.0200° | 27.93 | +5.10 | +22.3% | ✅ 良好 |
| 11 | 0.0150° | 27.85 | +5.02 | +22.0% | ✅ 良好 |
| 12 | 0.0120° | 27.49 | +4.66 | +20.4% | ✅ 良好 |
| 13 | 0.0100° | 27.01 | +4.18 | +18.3% | ✅ 良好 |
| 14 | 0.0090° | 27.19 | +4.36 | +19.1% | ✅ 良好 |
| 15 | 0.0080° | 26.20 | +3.37 | +14.8% | ✅ 中等 |
| 16 | 0.0070° | 25.92 | +3.09 | +13.5% | ✅ 中等 |
| 17 | 0.0060° | 25.47 | +2.64 | +11.6% | ✅ 中等 |
| 18 | 0.0050° | 24.97 | +2.14 | +9.4% | ✅ 中等 |
| 19 | 0.0040° | 24.23 | +1.40 | +6.1% | ✅ 小幅提升 |
| 20 | 0.0030° | 23.51 | +0.68 | +3.0% | ✅ 小幅提升 |
| 21 | 0.0020° | 23.73 | +0.90 | +3.9% | ✅ 小幅提升 |
| 22 | **0.0010°** | **22.83** | **0.00** | **0.0%** | 📍 基线 |
| 23 | 0.0005° | 22.49 | -0.34 | -1.5% | ❌ 太严格 |

---

## 📈 二、ESM角度阈值深度分析

### � 完整趋势曲线

```
得分
29.5 |                    ████████
29.0 |              ██████        ████
28.5 |          ████                  ██
28.0 |      ████                        ██
27.5 |    ██
27.0 |  ██                                ██
26.5 |██
26.0 |                                      ██
     +------------------------------------------
     0.001  0.01  0.02  0.03  0.05  0.07  0.10
                    角度阈值 (度)
```

### 🔍 关键区间分析

#### 阶段1: 快速上升期 (0.001° - 0.030°)
- **特征**: 得分快速增长
- **增长率**: 平均每0.01°提升约2分
- **原因**: 放宽阈值大幅增加有效ESM-雷达匹配数量

#### 阶段2: 平台期 (0.030° - 0.070°)
- **特征**: 得分稳定在高位
- **最优区间**: **0.060° - 0.070°**
- **得分**: 29.16 (峰值)
- **原因**: 匹配数量与噪声达到最佳平衡

#### 阶段3: 缓慢下降期 (0.070° - 0.100°)
- **特征**: 得分开始下降
- **下降幅度**: 0.070° → 0.100° 下降 0.46分 (-1.6%)
- **原因**: 角度过大引入噪声匹配

### 💡 核心结论

**最优角度阈值**: **0.060° - 0.070°**

- ✅ 得分最高: 29.16
- ✅ 相比基线提升: +27.7%
- ✅ 稳定性好: 0.060°和0.070°得分相同
- ✅ 容错性强: 0.045° - 0.080° 范围内得分都 > 29.0

**推荐配置**: `esm_angle_threshold = 0.065°` (取中间值，兼顾性能和稳定性)

---

## 📊 三、其他参数影响力分析

### 参数影响力排名

| 排名 | 参数名称 | 影响等级 | 最大影响 | 推荐操作 |
|:---:|---------|:-------:|:-------:|---------|
| 🥇 | **ESM角度阈值** | ⭐⭐⭐⭐⭐ | **+27.7%** | 设置为 0.060°-0.070° |
| 🥈 | **RANSAC模块** | ⭐⭐⭐⭐⭐ | **-16.0%** | 必须开启 |
| 🥉 | **ESM距离检查** | ⭐⭐⭐⭐⭐ | **-35.7%** | 保持200km，不要缩小 |
| 4 | 插值迭代次数 | ⭐⭐⭐ | +1.2% | 可增加到5轮 |
| 5 | ESM合并模块 | ⭐⭐⭐ | -2.5% | 保持开启 |
| 6 | 去重模块 | ⭐ | +0.3% | 可关闭 |
| 7 | 去重距离 | ⭐ | 0.0% | 无影响 |
| 8 | ESM速度阈值 | ⭐ | 0.0% | 无影响 |

### � 关键模块开关

#### RANSAC模块 (enable_ransac)

| 配置 | 得分 | 影响 |
|:----:|:----:|:----:|
| 关闭 | 19.17 | -16.0% ❌❌ |
| **开启** | **22.83** | **基线** ✅ |

**结论**: RANSAC对单点轨迹扩展至关重要，必须开启！

#### ESM合并模块 (enable_esm_merge)

| 配置 | 得分 | 影响 |
|:----:|:----:|:----:|
| 关闭 | 22.27 | -2.5% ❌ |
| **开启** | **22.83** | **基线** ✅ |

**结论**: 未定位ESM匹配能增加定位点，建议开启。

#### 去重模块 (enable_deduplication)

| 配置 | 得分 | 影响 |
|:----:|:----:|:----:|
| **关闭** | **22.89** | **+0.3%** ✅ |
| 开启 | 22.83 | 基线 |

**结论**: 关闭去重略有提升，可能是去重误删了有用数据。

### 📏 距离和速度阈值

#### ESM交叉定位距离检查 (esm_check_distance)

| 参数值 | 得分 | 影响 |
|:-----:|:----:|:----:|
| 150km | 14.68 | -35.7% ❌❌❌ |
| **200km** | **22.83** | **基线** ✅ |
| 250km | 22.83 | 0.0% ✅ |

**结论**: 150km太严格会过滤大量有效点，200km是合理阈值。

#### 去重距离 (safe_distance)

100m - 300m 范围内对结果**无影响**，说明雷达点密度不高。

#### ESM速度阈值 (esm_speed_threshold)

800 - 1500 m/min 范围内对结果**无影响**，说明船只速度普遍较低。

### 🔄 迭代优化参数

#### 插值迭代次数 (iteration_rounds)

| 参数值 | 得分 | 影响 |
|:-----:|:----:|:----:|
| 1轮 | 21.50 | -5.8% ❌ |
| 2轮 | 22.47 | -1.6% ⚠️ |
| **3轮** | **22.83** | **基线** |
| **5轮** | **23.10** | **+1.2%** ✅ |

**结论**: 迭代次数越多越好但收益递减，5轮是性价比较高的选择。

---

## 🎯 四、最优配置推荐

### 🏆 推荐配置 (预期得分: ~29.2)

```python
optimal_config = {
    # 预处理阶段
    'safe_distance': 200,                    # 去重距离 (影响不大)
    'esm_angle_threshold': 0.065,            # ⭐⭐⭐ 最关键！设置为0.060-0.070
    'esm_speed_threshold': 1000,             # 速度阈值 (影响不大)
    'esm_check_distance': 200000,            # ⭐ 保持200km，不要缩小
    'enable_deduplication': False,           # ⭐ 关闭去重略有提升
    'enable_esm_merge': True,                # ⭐ 必须开启

    # 插值阶段
    'update_distance': 600,                  # 更新距离阈值
    'update_speed': 800,                     # 更新速度阈值
    'update_angle': 90,                      # 更新角度阈值
    'ransac_distance': 500,                  # RANSAC距离阈值
    'ransac_min_points': 5,                  # RANSAC最小点数
    'iteration_rounds': 5,                   # ⭐ 增加到5轮
    'enable_ransac': True,                   # ⭐⭐⭐ 必须开启！
}
```

### 📊 配置对比

| 配置 | 得分 | 相对基线 | 说明 |
|:---:|:----:|:-------:|------|
| **基线配置** | 22.83 | 0.0% | 原始20_ans方法 |
| **仅优化角度阈值** | 29.16 | +27.7% | esm_angle_threshold=0.065 |
| **推荐配置** | ~29.5 | ~+29% | 角度0.065 + 关闭去重 + 5轮迭代 |

### 🚀 快速应用

修改 `our_ans/20_ans/preprocess.py` 和 `simple_interpolation.py` 中的参数：

**preprocess.py**:
```python
# Line 108: 关闭去重或注释掉去重调用
# deduplacate_radar_points_updated = dedumplacate(...)

# Line 228: 修改角度阈值
if abs(angle_diff) < 0.065:  # 原来是 0.001
```

**simple_interpolation.py**:
```python
# Line 230: 修改迭代次数
nrand = 5  # 原来是 3
```

---

## 📈 五、实验方法论总结

### ✅ 成功经验

1. **分阶段探索**: 先粗粒度扫描，再细粒度优化
   - 第一阶段: 0.001° - 0.030° 发现上升趋势
   - 第二阶段: 0.030° - 0.100° 找到最优点

2. **关注趋势而非单点**:
   - 0.060°和0.070°得分相同 → 说明找到了稳定的最优区间
   - 0.080°开始下降 → 确认了上限

3. **模块化消融**:
   - 先测试模块开关 (enable_xxx)
   - 再测试参数数值
   - 最后组合优化

### 📝 关键洞察

1. **ESM角度阈值的物理意义**:
   - 0.001°太严格 → 漏掉大量真实匹配
   - 0.065°最优 → 匹配数量与噪声的最佳平衡
   - 0.100°太宽松 → 引入过多噪声匹配

2. **为什么角度阈值影响这么大？**
   - ESM提供方位角信息，是定位的关键
   - 角度阈值直接决定ESM-雷达点匹配数量
   - 匹配点越多 → 定位点越多 → 轨迹越完整

3. **RANSAC的重要性**:
   - 处理单ESM点的轨迹扩展
   - 对噪声鲁棒
   - 关闭损失16% → 说明很多轨迹依赖RANSAC扩展

---

## 🔮 六、后续优化方向

### 🎯 短期优化 (1-2天)

#### 1. 组合优化实验
测试最优参数的组合效果：
```python
combo_config = {
    'esm_angle_threshold': 0.065,
    'enable_deduplication': False,
    'iteration_rounds': 5,
}
```
**预期提升**: 29.5 - 30.0 分

#### 2. 插值阶段参数化
当前插值阶段的参数都是硬编码的，可以尝试优化：
- `update_distance`: 600 → 800, 1000
- `ransac_distance`: 500 → 700, 1000
- `update_angle`: 90 → 120, 150

**预期提升**: 0.5 - 1.0 分

### 🔬 中期优化 (3-5天)

#### 3. 失败案例分析
- 找出得分低的船只
- 分析轨迹重构失败的原因
- 针对性优化

#### 4. 时间窗口优化
- 分析不同时间段的数据质量
- 动态调整参数

#### 5. 传感器权重优化
- 不同传感器的可靠性不同
- 可以引入权重机制

### 🚀 长期优化 (1-2周)

#### 6. 算法改进
- 改进RANSAC算法
- 优化插值策略
- 引入卡尔曼滤波

#### 7. 集成学习
- 多组参数生成多个结果
- 投票或加权融合

---

## 📌 七、核心结论

### 🎯 最重要的发现

> **ESM角度阈值从 0.001° 放宽到 0.065° 可将得分从 22.83 提升至 29.16，提升幅度达 27.7%！**

这是本次消融实验最重要的发现，也是最容易实施的优化。

### ✅ 立即可用的优化

1. **修改角度阈值**: `esm_angle_threshold = 0.065°` → **+27.7%**
2. **关闭去重**: `enable_deduplication = False` → **+0.3%**
3. **增加迭代**: `iteration_rounds = 5` → **+1.2%**

**总预期提升**: **~29%** (从22.83到29.5)

### ⚠️ 必须避免的操作

1. ❌ 不要缩小ESM距离检查 (150km会损失35.7%)
2. ❌ 不要关闭RANSAC (会损失16.0%)
3. ❌ 不要关闭ESM合并 (会损失2.5%)

### 🎓 方法论启示

1. **参数调优的重要性**: 简单的参数调整就能带来27.7%的提升
2. **系统化实验的价值**: 两阶段29个实验找到了最优配置
3. **趋势分析的必要性**: 不要在第一个局部最优点停下

---

## 📊 附录：完整实验数据

### 第一阶段实验 (19个)
- 基线和模块开关: 5个
- 去重距离: 5个
- ESM参数: 6个
- 插值迭代: 3个

### 第二阶段实验 (10个)
- ESM角度阈值细化: 10个 (0.030° - 0.100°)

### 数据文件
- `angle_threshold_summary.csv`: 第一阶段完整数据
- `angle_threshold_phase2_summary.csv`: 第二阶段完整数据

---

**报告生成时间**: 2025-11-11
**实验执行者**: Augment Agent
**数据来源**: our_ans/ablation_results/
